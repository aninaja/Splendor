{% extends "base.html" %}

{% block page_title %} Patient {% endblock page_title %}


{% block content %}

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                {% if messages %}
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">x</button>
                    {% for message in messages %}
                    <span class="lh-1">{{ message }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">Patient Information</h3>
            </div>
                <div class="card-body">
                    <div class="form-group row">
                        <div class="col-md-6">
                            {% for patient in patient_info %}
                             <ul class="list-group list-group mb-3">
                                 <li class="list-group-item"><b>Name</b><a class="float-right">{{ patient.first_name }} {{ patient.last_name }}</a></li>
                                 <li class="list-group-item"><b>Email</b><a class="float-right">{{ patient.email }}</a></li>
                                 <li class="list-group-item"><b>Gender</b><a class="float-right">{{ patient.userprofile.gender }}</a></li>
                                 <li class="list-group-item"><b>Mobile</b><a class="float-right">{{ patient.mobile }}</a></li>
                                 <li class="list-group-item"><b>Birthdate</b><a class="float-right">{{ patient.date_of_birth }}</a></li>
                                 <li class="list-group-item"><b>Status</b>
                                 {% if patient.is_active %}
                                   <a class="float-right">Active</a>
                                 {% else %}
                                    <a class="float-right">Inactive</a></li>
                                 {% endif %}
                            </ul>
                               {% endfor %}
                         </div>
                    </div>
                </div>
            <div class="card-footer">
                {% for patient in patient_info %}
                        <a href="{% url 'transactions:transaction_create' patient.id %}"><button class="btn btn-primary">Add Transaction</button></a>
                        {% if patient.userprofile.total_points > 0 %}
                            <a href="{% url 'redemptions:redeem_points' patient.id %}"><button class="btn btn-success">Redeem Points</button></a>
                        {% endif %}
                        <a href="{% url 'patients:patient_edit' patient.id %}"><button class="btn btn-primary">Edit</button></a>
                        {% if date_now > patient.userprofile.account_expiry %}
                            <a href="{% url 'patients:patient_renewal' patient.id %}"><button class="btn btn-primary float-right">Renew Membership</button></a>
                        {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
        <!-- /.container-fluid -->
</section>
<!-- /.content -->

<section class="content">
    <div class="container-fluid">
        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title">Patient Transaction</h3>
                {% for patient in patient_info %}
                <a href="{% url 'redemptions:redeemed_points_list' patient.id %}" ><button class="btn btn-info float-right">Redeemed</button></a>
                {% endfor %}
            </div>
             <div class="card-body">
                  <table id="patient_info-table" class="table table-striped projects">
                     <thead>
                        <tr>
                            <th>USER ID</th>
                            <th>REFERENCE ID</th>
                            <th>AMOUNT PAID</th>
                            <th>POINTS EARNED</th>
                            <th>DATE EARNED</th>
                        </tr>
                     </thead>
                     <tbody>
                         {% for transact in transactions %}
                        <tr>
                            <th>{{ transact.id }}</th>
                            <td>{{ transact.referenced_id }}</td>
                            <td>{{ transact.price_amount }}</td>
                            <td>{{ transact.points }}</td>
                            <td>{{ transact.date_added }}</td>
                        </tr>
                        {% endfor %}
                     </tbody>
                  </table>
             </div>
        </div>
    </div>
        <!-- /.container-fluid -->
</section>
<!-- /.content -->

{% endblock content %}


{% block script %}
    <script>
      $(function () {
        $('#patient_info-table').DataTable({
          "paging": true,
          "lengthChange": false,
          "searching": true,
          "ordering": false,
          "info": true,
          "autoWidth": false,
          "responsive": true,
          "pageLength": 10,
        });
      });
    </script>
{% endblock script %}